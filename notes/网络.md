### TCP/IP协议

计算机与网络设备要相互通信，双方必须基于相同的方法，比如如何探测到通信目标，由那一边先发起通信、使用哪种语言进行通信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。我们把这种规则称为协议。



### 状态码

当客户端向服务端发送请求之后，描述服务端返回的结果。同过状态码可以判断请求是否成功执行了，还是执行失败了。

#### 2xx 成功

##### 2xx表示被正常处理了

200 OK

204 No Content

206 Partial Content

3xx 重定向

301 Moved Permanently

302 Found

303 See Other

304 Not Modified

307 Temporary Redirect

4xx

400 Bad Request

401 Unauthorized 

403 Forbidden

404 Not Found

5xx

500 Internal Server Error

503 Service Unavailable



### 五层协议的体系结构

- 应用层

应用层的任务就是通过应用进程间的交互来完成特定网络应用，应用层协议定义的的是应用进程间的通信和交互规则，对于不同的网路需要不同的应用层协议。我们把应用层交互的数据叫做报文。

- 运输层

  主要任务就是负责两台主机进程间的通信提供通用的数据传输服务。

  TCP：面向连接，可靠的数据传输服务

  UDP：无连接，不保证数据传输的可靠性

  UDP:特点

  - 无连接
  - 尽最大努力进行交付，不保证可靠性，因此主机不需要维护复杂的连接状态
  - 面向报文
  - 没有拥塞控制
  - 支持一对一，一对多，多对一和多对多的交互通信
  - 首部开销小，只有8个字节，比tcp的20个字节的首部要短

  TCP的特点

  - 面向连接的
  - 点对点的通信
  - 保证了数据的可靠传输，无差错，不丢失，不重复，并且按序到达
  - 全双工
  - 面向字节流

- 网络层

  在计算机网络进行通信的两个计算机之间可能会经过多个数据链路，可能还要经过多个通信子网，网路层的任务就是选择合适的网络路由和交换节点，确保数据的及时发送。在发送数据的时候把运输层的数据报封装成组和包进行传送，网络层使用的协议是IP协议，因此分组也叫数据报。

- 数据链路层

  将网络层交下来的IP数据组装成帧。在两个相邻节点的链路上传送帧。

- 物理层

  实现相邻计算机节点之间比特流的透明传输，尽可能屏蔽掉具体传输介质和物理设备的差异。



### TCP三次握手和四次挥手

为了准确无误地把数据送达目标，TCP协议采用了三次握手

- 客户端–发送带有 SYN 标志的数据包–一次握手–服务端
- 服务端–发送带有 SYN/ACK 标志的数据包–二次握手–客户端
- 客户端–发送带有带有 ACK 标志的数据包–三次握手–服务端

### 为什么要进行三次握手

三次握手的目的是建立可靠的通信信道，三次握手最主要的目的就是双方确认自己与对发送与接受都是正常的。

要防止已经失效的连接请求报文突然又传送到了服务器，从而产生错误。

syn是TCP/IP建立连接时使用的握手信号，接受端传回发送端所发送的syn是为了告诉发送端，我接受到的信息就是你所发的信号。双发通信无误必须两者互相发送信息都无误，传了syn证明，发送方到接受的通道是没有问题的，但是接受方到发送到还需要ack信号来确认。

### 四次挥手

客户端发送一个fin信号，用来关闭客户端到服务端的数据传送，此时是半关闭状态。

服务器收到这个fin它发回一个ack，确认序号为收到的序号加1，和syn一样，一个fin将占用一个序号

服务器关闭与客户端的连接，发送一个fin给客户端

客户端发回一个ack报文确认，并将确认序号设置为收到的序号加1



第一，保证客户端发送的最后一个ACK报文能够到达服务器，因为这个ACK报文可能丢失，站在服务器的角度看来，我已经发送了FIN+ACK报文请求断开了，客户端还没有给我回应，应该是我发送的请求断开报文它没有收到，于是服务器又会重新发送一次，而客户端就能在这个2MSL时间段内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。

第二，防止类似与“三次握手”中提到了的“已经失效的连接请求报文段”出现在本连接中。客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。这样新的连接中不会出现旧连接的请求报文



# HTTPS

### 什么是https？

HTTPS是安全的HTTP，HTTP协议中的内容都是明文传输的，HTTPS的目的是将这些内容进行加密，确保信息传输的安全。最后一个S指的是SSL/TLS协议，它位于HTTP协议与TCP/IP协议的中间。

### 数据传输安全的意思？

- 客户端和服务器之间的通信只能又自己看得懂，第三方拿到数据也看不懂这些信息的真实含义。
- 第三方虽然看不懂，但是可以对数据篡改，因此客户端和服务端必须有能力判断数据是否被修改过。
- 客户端必须避免中间人攻击，即除了真正的服务器，任何第三方都无法冒充服务器。

### 怎么加密信息？

使用对称秘钥和非对称秘钥进行加密，对称秘钥是加密和解密都用相同的秘钥进行。非对称秘钥有两个秘钥，一个公钥和一个私钥。公钥加密的内容只有通过私钥才能解密，私钥加密的内容只有通过公钥进行解密。

使用对称加密一般比非对称加密快得多，对服务器的运算压力也小。

### 对称秘钥怎么传输?

服务器明文传输对称秘钥是不安去的，如果监听者拿到对称秘钥，以后的通信内容就被破解了。所以不能明文传输对称秘钥，而且不能用一个新的对称秘钥来加密原来的对称秘钥，否则新的对称秘钥同样无法传输，就是鸡生蛋，蛋生鸡的驳论。

这里我们采用非对称加密的方式，非对称加密的特性决定了服务器用私钥加密的内容并不是真正的加密，因为公钥所有人都有，所以服务器的密文能被所有人解析，但是私钥只掌握在服务器手上，这就带来了两个好的优势：

- 服务器下发的内容不能被伪造，因为别人都没有私钥，只有服务器有，所以无法加密。强行加密的后果是客户端使用公钥都无法完成解密。
- 任何人用公钥加密的内容都是绝对安全的，因为私钥只有服务端有，也就是只有真正的服务器可以看到加密的原文

所以传输对称秘钥的问题就迎刃而解了：秘钥不是由服务器下发的，而是由客户端生成并主动高数服务器。所以当引入非对称加密后，HTTPS的握手流程依然是两部，不过细节略有变化：

​	客户端：你好，我要发起一个HTTPS的请求，这是我的秘钥（用公钥加密后的）

​	服务端：好的，我知道你的秘钥了，后续就用它来传输。

### 公钥怎么传输？

对公钥进行加密，每一个HTTPS服务器都必须去专门的证书机构注册一个证书，证书中存储了用权威机构私钥加密的公钥。这样客户端用权威机构的公钥解密就可以了。

现在HTTPS协议握手阶段变成四步：

1. 客户端：你好，我要发起一个HTTPS请求，请给我公钥
2. 服务器：好的，这是我的证书，里面有加密后的公钥
3. 客户端：解密成功以后告诉服务器，这是我的对称秘钥
4. 服务器：好的，我知道了你的秘钥了，后续就用它来传输吧。

### 那么权威机构的公钥怎么传输呢？

这个公钥不用传输，会直接内置在各大操作系统或者浏览器的出厂设置里。之所以不把每个服务器的公钥内置在电脑里，一方面服务器太多，存不过来。另一方面操作系统也不信任你，凭什么你说你这个就是百度的证书呢。所以各个公司先去权威机构认证，申请证书，然后操作系统只会存储权威机构的公钥。因为权威机构数量有限，所以操作系统厂商相对来说容易管理。如果这个权威机构不够权威，胡乱发证书，就会取消他的资格，比如可怜的沃通。

### 怎么知道证书没有被篡改？

将信息哈希值随着信息一起传递。为了保证证书没有篡改，我们可以在传递证书的同时传递的哈希值。由于第三者无法解析数据，只能胡乱改，那么修改后的数据在解密后，就不能通过哈希。

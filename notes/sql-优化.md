### SQL优化

​	执行子查询时，MySql需要建立临时表，查询完毕之后再删除这些临时表，所以，子查询的速度会受到一定的影响。

优化：可以使用连接查询 join 代替子查询，连接查询时不需要建立临时表，其速度比子查询快。



### 数据库结构优化

- 将字段很多的表分解成多个表，对于字段较多的表，如果有些字段的使用频率很低，可以将这些字段分离出来形成新表。因为一个表的数据量很大的时候，会由于使用频率低的字段存在而变慢

- 增加中间表

  ​    对于需要经常联合查询的表，可以建立中间表，可以提高查询效率。

  ​    通过建立中间表，将需要通过联合查询的数据插入到中间表中，然后将原来的联合查询改为中间表查询。

- 增加冗余的字段

  设计数据表的时候尽量遵循范式理论的规约，尽可能的减少冗余字段，让数据库设计看起来很精致，优雅。但是合理的假如冗余字段可以提高查询速度。

  冗余字段的值在一个表中修改了，就要想办法在其他的表中更新，否则将会导致数据不一致的问题。



### 插入数据的优化

插入数据的时候，影响插入速度的主要是索引，唯一性校验，一次插入多条数据等。

插入数据的优化，不同的存储引擎优化手段不一样，在MySql中常用的存储引擎有MyISAM和InnoDB

两者的区别主要有：MyISAM是mysql默认的搜索引擎，基于传统ISAM类型，支持全文搜索，但不是事务安全的，而且不支持外键，每张MyISAM表存放在三个文件中。

InnoDB是事务型引擎，支持回滚，多版本并发控制，ACID事务，支持行级锁定



### 主要区别

- MyISAM是非事务安全的，而InnoDB是事务安全的。

- MyISAM锁的粒度是表级，而InnoDB支持行级锁定。

- MyISAM支持全文类型索引，而InnoDB不支持全文索引。

- MyISAM相对简单，在执行效率上要优于InnoDB，小型应用可以考虑使用MyISAM。

- MyISAM表是保存文件的形式，在跨平台的数据转移中使用MyISAM存储会省去不少的麻烦。

- InnoDB表比MyISAM表更安全，可以保证数据不会丢失的情况下，切换非事务表到事务表。



### 禁用索引

​	对于非空表，插入记录时，MySql会根据表的索引对插入的记录建立索引。如果插入大量数据，建立索引会降低插入数据速度。

​	为了解决这个问题，可以在批量插入数据之前禁用索引，数据插入完成后再开启索引。

- 禁用索引的语句：

`ALTER TABLE table_name DISABLE KEYS`

- 开启索引语句：

`ALTER TABLE table_name ENABLE KEYS`

对于空表批量插入数据，则不需要进行操作，因为MyISAM引擎的表是在导入数据后才建立索引。

### 禁用唯一性检查

- 唯一性校验会降低插入记录的速度，可以在插入记录之前禁用唯一性检查，插入数据完成后再开启。
- 禁用唯一性检查的语句：`SET UNIQUE_CHECKS = 0;`
- 开启唯一性检查的语句：`SET UNIQUE_CHECKS = 1;`



### 索引失效的场景

- 使用like关键字的查询

  在使用like关键字进行查询的查询语句中，如果匹配第一个字符串为%，索引不起作用，只有%不在第一个位置，索引才会起作用。

- 使用联合查询索引的查询

  MySQL可以为多个字段创建索引，一个索引可以包括16个字段。对于联合索引，只有查询条件中使用了这些字段中第一个字段时，索引才会生效。

- 使用OR关键字的查询

  查询语句的查询条件中只有OR关键字，并且OR前后的两个条件中的列都是索引时，索引才会生效，否则，索引不生效



### 数据库索引新建原则有那些？

1. 具有唯一性的属性必须增加唯一约束，与唯一索引
2. 经常出现在where子句中查询条件需要增加索引
3. 如果属性是大的文本不要增加索引
4. 字符串类型的索引需要指定长度，尽量使用前缀来早增加索引
5. 经常会被join联合查询的外键需要增加索引
6. 一张表不要增加太多的索引
7. 索引应该加在区分度比较高的属性上面
8. 不经常使用，或者很少使用的索引要删除掉